rename("msoa_name"=1) %>%
mutate(areas=str_split(msoa_name, " : ", 2),
msoa=sapply(areas,"[",1),
msoa_name=sapply(areas,"[",2)) %>%
filter(str_sub(msoa,1,1)=="E") %>%
left_join(msoa_map,by=c("msoa"="MSOA11CD"))%>%
rename("region"="RGN11NM") %>%
group_by(region) %>%
summarise(across(starts_with("age"),sum)) %>%
gather(variable, value, -region) %>%
spread(region, value) %>%
mutate(variable=parse_number(variable)) %>%
rename("age"="variable")%>%
mutate(age_group = cut(age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")),
n = rowSums(across(!starts_with("age"))),
cohort="ONS")
#        data/ONSdeaths2020.csv (downloaded va Nomis: https://www.nomisweb.co.uk/query/construct/components/apicomponent.aspx?menuopt=1611&subcomp=)
#
# output: /data/death_ons.csv.gz
#         /data/imd_ons.csv.gz
#         /data/age_ons_sex.csv.gz
#
# Author: Colm D Andrews
# Date: 14/10/2021
#
################################################################################
msoa_map<-read_csv(here::here("data","ONS_MSOA_to_region_map.csv")) %>%
select(MSOA11CD,RGN11NM)
age_ons<-read_csv(here::here("data","34674549.csv"),skip = 6,show_col_types = FALSE) %>%
rename("msoa_name"=1) %>%
mutate(areas=str_split(msoa_name, " : ", 2),
msoa=sapply(areas,"[",1),
msoa_name=sapply(areas,"[",2)) %>%
filter(str_sub(msoa,1,1)=="E") %>%
left_join(msoa_map,by=c("msoa"="MSOA11CD"))%>%
rename("region"="RGN11NM") %>%
group_by(region) %>%
summarise(across(starts_with("age"),sum)) %>%
gather(variable, value, -region) %>%
spread(region, value) %>%
mutate(variable=parse_number(variable)) %>%
rename("age"="variable")%>%
mutate(age_group = cut(age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")),
n = rowSums(across(!starts_with("age"))),
cohort="ONS")
age_ons<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 8)
age_ons
age_ons<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 6)
age_ons_female<-read_csv(here::here("data","124465290female.csv"),skip = 6,show_col_types = FALSE) %>%
rename("msoa_name"=1) %>%
mutate(areas=str_split(msoa_name, " : ", 2),
msoa=sapply(areas,"[",1),
msoa_name=sapply(areas,"[",2)) %>%
filter(str_sub(msoa,1,1)=="E") %>%
left_join(msoa_map,by=c("msoa"="MSOA11CD"))%>%
rename("region"="RGN11NM") %>%
group_by(region) %>%
summarise(across(starts_with("age"),sum)) %>%
gather(variable, value, -region) %>%
spread(region, value) %>%
mutate(variable=parse_number(variable)) %>%
rename("age"="variable")%>%
mutate(age_group = cut(age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")),
n = rowSums(across(!starts_with("age"))),
cohort="ONS",
sex="female")
View(age_ons_female)
age_ons_total<-age_ons %>% filter(age="all_ages")
age_ons_total<-age_ons %>% filter(age=="all_ages")
age_ons_total<-age_ons %>% filter(Age==`All Ages`)
age_ons_total<-age_ons %>% filter(Age=="All Ages")
age_ons_total
age_ons<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 6,n_max = 91)
age_ons<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 6,n_max = 93)
age_ons_total<-age_ons %>% filter(Age=="All Ages")
age_ons_total
age_ons  %>% filter(Age!="All Ages")
age_ons<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 6,n_max = 93)
age_ons_total<-age_ons %>% filter(Age=="All Ages")
age_ons<-age_ons  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 6,n_max = 93)
age_ons_total<-age_ons %>% filter(Age=="All Ages")
age_ons<-age_ons  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric))))
age_ons<-age_ons  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="Total" )
age_ons_total
age_ons_total<-age_ons %>% filter(Age=="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="Total" )
age_ons_total<-age_ons %>% filter(Age=="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric))))
View(age_ons_total)
age_ons<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 6,n_max = 93)
age_ons_total<-age_ons %>% filter(Age=="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="Total" )
age_ons<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 6,n_max = 93)
View(age_ons_total)
age_ons_total<-age_ons %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="Total" )
age_ons<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 6,n_max = 93)
age_ons_total<-age_ons %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="Total" )
age_ons<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 6,n_max = 93)
age_ons_total<-age_ons %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="Total" )
age_ons_total<-age_ons %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons<-age_ons  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_total,by="Region")
age_ons<-age_ons  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_total,by="Region") %>%
mutate(percentage=N/Total*100)
age_ons<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 6,n_max = 93)
age_ons_total<-age_ons %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons<-age_ons  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_total,by="Region") %>%
mutate(percentage=N/Total*100)
sum(age_ons$percentage[Region=="East"])
sum(age_ons$percentage[where(age_ons$Region=="East"]))
sum(age_ons$percentage[where(age_ons$Region=="East")])
sum(age_ons$percentage[which(age_ons$Region=="East")])
sum(age_ons$percentage[which(age_ons$Region=="East Midlands")])
age_ons_male<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 109,n_max = 93)
View(age_ons_male)
age_ons_male<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 108,n_max = 93)
age_ons<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 6,n_max = 93)
age_ons_total<-age_ons %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons<-age_ons  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
Age=parse_number(Age))
age_ons<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 6,n_max = 93)
age_ons_total<-age_ons %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons<-age_ons  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
Age=parse_number(Age),
age_group = cut(age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")))
age_ons<-age_ons  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
Age=parse_number(Age),
age_group = cut(Age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")))
age_ons_male<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 108,n_max = 93)
age_ons_male_total<-age_ons_male %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons_male<-age_ons_male  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
Age=parse_number(Age),
age_group = cut(Age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")))
sum(age_ons_male$percentage[which(age_ons_male$Region=="East")])
age_ons_male<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 108,n_max = 93)
age_ons_male_total<-age_ons_male %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons_male<-age_ons_male  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_male_total,by="Region") %>%
mutate( percentage=N/Total*100,
Age=parse_number(Age),
age_group = cut(Age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")))
sum(age_ons_male$percentage[which(age_ons_male$Region=="East")])
age_ons_female<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 210,n_max = 93)
age_ons_female_total<-age_ons_female %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons_female<-age_ons_female  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_female_total,by="Region") %>%
mutate( percentage=N/Total*100,
Age=parse_number(Age),
age_group = cut(Age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")))
View(age_ons_female)
sum(age_ons_female$percentage[which(age_ons_female$Region=="East")])
age_ons_female<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 210,n_max = 93)
age_ons_female_total<-age_ons_female %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons_female<-age_ons_female  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_female_total,by="Region") %>%
mutate( percentage=N/Total*100,
Age=parse_number(Age),
age_group = cut(Age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")),
sex="female",
cohort="ONS")
age_ons_male<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 108,n_max = 93)
age_ons_male_total<-age_ons_male %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons_male<-age_ons_male  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_male_total,by="Region") %>%
mutate( percentage=N/Total*100,
Age=parse_number(Age),
age_group = cut(Age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")),
sex="female",
cohort="ONS")
age_ons_female<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 210,n_max = 93)
age_ons_female_total<-age_ons_female %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons_female<-age_ons_female  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_female_total,by="Region") %>%
mutate( percentage=N/Total*100,
Age=parse_number(Age),
age_group = cut(Age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")),
sex="female",
cohort="ONS") %>%
bind_rows(age_ons_male)
age_ons<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 6,n_max = 93)
age_ons_total<-age_ons %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons<-age_ons  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
Age=parse_number(Age),
age_group = cut(Age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")),
sex="Total",
cohort="ONS")
age_ons_female<-age_ons_female  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_female_total,by="Region") %>%
mutate( percentage=N/Total*100,
Age=parse_number(Age),
age_group = cut(Age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")),
sex="female",
cohort="ONS") %>%
bind_rows(age_ons_male,
age_ons)
age_ons_female<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 210,n_max = 93)
age_ons_female_total<-age_ons_female %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons_female<-age_ons_female  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_female_total,by="Region") %>%
mutate( percentage=N/Total*100,
Age=parse_number(Age),
age_group = cut(Age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")),
sex="female",
cohort="ONS") %>%
bind_rows(age_ons_male,
age_ons)
# male
age_ons_male<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 108,n_max = 93)
age_ons_male_total<-age_ons_male %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons_male<-age_ons_male  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_male_total,by="Region") %>%
mutate( percentage=N/Total*100,
Age=parse_number(Age),
age_group = cut(Age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")),
sex="female",
cohort="ONS")
######## females
age_ons_female<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 210,n_max = 93)
age_ons_female_total<-age_ons_female %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons_female<-age_ons_female  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_female_total,by="Region") %>%
mutate( percentage=N/Total*100,
Age=parse_number(Age),
age_group = cut(Age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")),
sex="female",
cohort="ONS")
### Combined
age_ons<-read_excel(here::here("data","nomis_2021_11_22_110504.xlsx"),skip = 6,n_max = 93)
age_ons_total<-age_ons %>% filter(Age=="All Ages") %>%
select(-Age) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
age_ons<-age_ons  %>% filter(Age!="All Ages") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!Age, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
Age=parse_number(Age),
age_group = cut(Age, breaks = seq(0,95,5), right = F, labels = c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")),
sex="Total",
cohort="ONS") %>%
bind_rows(age_ons_male,
age_ons_female)
write_csv(age_ons,here::here("data","age_ons_sex.csv.gz"))  ####add .gz to the end
eth_ons<-read_excel(here::here("data","nomis_2021_11_22_212018.xlsx"),skip = 6,n_max = 93)
View(eth_ons)
eth_ons<-read_excel(here::here("data","nomis_2021_11_22_212018.xlsx"),skip = 8,n_max = 93)
eth_ons<-read_excel(here::here("data","nomis_2021_11_22_212018.xlsx"),skip = 8,n_max = 93)
eth_ons_total<-eth_ons %>% filter(`Ethnic Group`=="All usual residents") %>%
select(-`Ethnic Group`) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Ethnicity",values_to ="Total" )
View(eth_ons_total)
eth_ons<-eth_ons  %>% filter(`Ethnic Group`!="All usual residents") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!`Ethnic Group`, names_to = "Ethnicity",values_to ="N" ) %>%
full_join(age_ons_total,by="Ethnicity") %>%
mutate( percentage=N/Total*100,
cohort="ONS")
eth_ons<-read_excel(here::here("data","nomis_2021_11_22_212018.xlsx"),skip = 8,n_max = 93)
eth_ons_total<-eth_ons %>% filter(`Ethnic Group`=="All usual residents") %>%
select(-`Ethnic Group`) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Ethnicity",values_to ="Total" )
eth_ons<-eth_ons  %>% filter(`Ethnic Group`!="All usual residents") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!`Ethnic Group`, names_to = "Ethnicity",values_to ="N" ) %>%
full_join(age_ons_total,by="Ethnicity") %>%
mutate( percentage=N/Total*100,
cohort="ONS")
eth_ons<-eth_ons  %>% filter(`Ethnic Group`!="All usual residents") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!`Ethnic Group`, names_to = "Ethnicity",values_to ="N" ) %>%
full_join(age_ons_total,by="Ethnicity") %>%
mutate( percentage=N/Total*100,
cohort="ONS")
eth_ons<-eth_ons  %>% filter(`Ethnic Group`!="All usual residents") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!`Ethnic Group`, names_to = "Ethnicity",values_to ="N" )
eth_ons_total<-eth_ons %>% filter(`Ethnic Group`=="All usual residents") %>%
select(-`Ethnic Group`) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
eth_ons<-read_excel(here::here("data","nomis_2021_11_22_212018.xlsx"),skip = 8,n_max = 93)
eth_ons_total<-eth_ons %>% filter(`Ethnic Group`=="All usual residents") %>%
select(-`Ethnic Group`) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
eth_ons<-eth_ons  %>% filter(`Ethnic Group`!="All usual residents") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!`Ethnic Group`, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
cohort="ONS")
sum(eth_ons$percentage[which(eth_ons$Region=="East")])
eth_ons<-read_excel(here::here("data","nomis_2021_11_22_212018.xlsx"),skip = 8,n_max = 24)
eth_ons_total<-eth_ons %>% filter(`Ethnic Group`=="All usual residents") %>%
select(-`Ethnic Group`) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
eth_ons<-eth_ons  %>% filter(`Ethnic Group`!="All usual residents") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!`Ethnic Group`, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
cohort="ONS")
sum(eth_ons$percentage[which(eth_ons$Region=="East")])
eth_ons<-read_excel(here::here("data","nomis_2021_11_22_213653.xlsx"),skip = 8,n_max = 19)
eth_ons_total<-eth_ons %>% filter(`Ethnic Group`=="All usual residents") %>%
select(-`Ethnic Group`) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
eth_ons<-eth_ons  %>% filter(`Ethnic Group`!="All usual residents") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!`Ethnic Group`, names_to = "Region",values_to ="N" ) %>%
full_join(age_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
cohort="ONS")
eth_18_ons<-read_excel(here::here("data","nomis_2021_11_22_213653.xlsx"),skip = 8,n_max = 19)
eth_18_ons_total<-eth_18_ons %>% filter(`Ethnic Group`=="All usual residents") %>%
select(-`Ethnic Group`) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
eth_18_ons<-eth_18_ons  %>% filter(`Ethnic Group`!="All usual residents") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!`Ethnic Group`, names_to = "Region",values_to ="N" ) %>%
full_join(eth_18_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
cohort="ONS")
sum(eth_ons$percentage[which(eth_ons$Region=="East")])
sum(eth_ons$percentage[which(eth_ons$Region=="East Midlands")])
eth_18_ons<-read_excel(here::here("data","nomis_2021_11_22_213653.xlsx"),skip = 8,n_max = 19)
eth_18_ons_total<-eth_18_ons %>% filter(`Ethnic Group`=="All usual residents") %>%
select(-`Ethnic Group`) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
View(eth_18_ons_total)
eth_18_ons<-eth_18_ons  %>% filter(`Ethnic Group`!="All usual residents") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!`Ethnic Group`, names_to = "Region",values_to ="N" ) %>%
full_join(eth_18_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
cohort="ONS")
sum(eth_ons$percentage[which(eth_ons$Region=="East Midlands")])
View(eth_18_ons)
eth_18_ons<-read_excel(here::here("data","nomis_2021_11_22_213653.xlsx"),skip = 8,n_max = 19)
sum(eth_18_ons$East)
sum(eth_18_ons$East)/2
eth_18_ons<-eth_18_ons  %>% filter(`Ethnic Group`!="All usual residents") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!`Ethnic Group`, names_to = "Region",values_to ="N" ) %>%
full_join(eth_18_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
cohort="ONS")
sum(eth_18_ons$percentage[which(eth_18_ons$Region=="East Midlands")])
sum(eth_18_ons$percentage[which(eth_18_ons$Region=="East")])
eth_5_ons<-read_excel(here::here("data","nomis_2021_11_22_213624.xlsx"),skip = 8,n_max = 6)
eth_5_ons_total<-eth_5_ons %>% filter(`Ethnic Group`=="All usual residents") %>%
select(-`Ethnic Group`) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
eth_5_ons<-read_excel(here::here("data","nomis_2021_11_22_215327"),skip = 8,n_max = 6)
eth_5_ons<-read_excel(here::here("data","nomis_2021_11_22_215327.xlsx"),skip = 8,n_max = 6)
eth_5_ons_total<-eth_5_ons %>% filter(`Ethnic Group`=="All usual residents") %>%
select(-`Ethnic Group`) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
eth_5_ons<-eth_5_ons  %>% filter(`Ethnic Group`!="All usual residents") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!`Ethnic Group`, names_to = "Region",values_to ="N" ) %>%
full_join(eth_5_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
cohort="ONS")
View(eth_5_ons)
sum(eth_5_ons$percentage[which(eth_5_ons$Region=="East")])
eth_18_ons<-eth_18_ons  %>% filter(`Ethnic Group`!="All usual residents") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!`Ethnic Group`, names_to = "Region",values_to ="N" ) %>%
full_join(eth_18_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
cohort="ONS",
group="18")
eth_18_ons<-read_excel(here::here("data","nomis_2021_11_22_213653.xlsx"),skip = 8,n_max = 19)
eth_18_ons_total<-eth_18_ons %>% filter(`Ethnic Group`=="All usual residents") %>%
select(-`Ethnic Group`) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
eth_18_ons<-eth_18_ons  %>% filter(`Ethnic Group`!="All usual residents") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!`Ethnic Group`, names_to = "Region",values_to ="N" ) %>%
full_join(eth_18_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
cohort="ONS",
group="18")
eth_5_ons<-read_excel(here::here("data","nomis_2021_11_22_215327.xlsx"),skip = 8,n_max = 6)
eth_5_ons_total<-eth_5_ons %>% filter(`Ethnic Group`=="All usual residents") %>%
select(-`Ethnic Group`) %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(everything(), names_to = "Region",values_to ="Total" )
eth_5_ons<-eth_5_ons  %>% filter(`Ethnic Group`!="All usual residents") %>%
mutate(England=rowSums(across(where(is.numeric)))) %>%
pivot_longer(!`Ethnic Group`, names_to = "Region",values_to ="N" ) %>%
full_join(eth_5_ons_total,by="Region") %>%
mutate( percentage=N/Total*100,
cohort="ONS",
group="5") %>%
bind_rows(eth_18_ons)
