filter(region!="England") %>%
ggplot(aes(x=age_group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size=16,angle = 90,hjust=0.95,vjust=0.2)) +
xlab("") + ylab(" % of cohort") +
scale_x_discrete(limits = agelevels)
ggsave(filename=here::here("output", "plots","age_count.jpg"),age_plot,width = 60, height = 30, units = "cm")
age_plot_eng <-age %>%
filter(region=="England") %>%
ggplot(aes(x=age_group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size=16,angle = 90,hjust=0.95,vjust=0.2)) +
xlab("") + ylab(" % of cohort") +
scale_x_discrete(limits = agelevels)
ggsave(filename=here::here("output", "plots","age_count_eng.jpg"),age_plot_eng,width = 15, height = 10, units = "cm")
############################################## sex
sex<-age_sex %>%
select(sex, cohort,N,region) %>%
group_by(cohort,sex,region) %>%
summarise(N = sum(N)) %>%
group_by(region,cohort) %>%
mutate(Total=sum(N)) %>%
ungroup %>%
mutate(percentage = round((N/Total)*100,2))
sex_plot<-sex %>%
filter(region!="England") %>%
ggplot(aes(x=sex, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge")  + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size=16,angle = 90,hjust=0.95,vjust=0.2)) +
xlab("") + ylab(" % of cohort")
ggsave(filename=here::here("output", "plots","sex_count.jpg"),sex_plot,width = 30, height = 15, units = "cm")
sex_plot_eng<-sex %>%
filter(region=="England") %>%
ggplot(aes(x=sex, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge")  + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size=16,angle = 90,hjust=0.95,vjust=0.2)) +
xlab("") + ylab(" % of cohort")
ggsave(filename=here::here("output", "plots","sex_count_eng.jpg"),sex_plot_eng,width = 15, height = 10, units = "cm")
############### ethnicity
ethnicity<-read_csv(here::here("output", "tables","ethnic_group.csv"))
ethnicity_plot<-ethnicity %>%
filter(region!="England",group=="5_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","ethnicity_count.jpg"),ethnicity_plot,width = 45, height = 30, units = "cm")
ethnicity_plot_eng<-ethnicity %>%
filter(region=="England",group=="5_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","ethnicity_count_eng.jpg"),ethnicity_plot_eng,width = 30, height = 30, units = "cm")
ethnicity_plot16<-ethnicity %>%
filter(region!="England",group=="16_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","ethnicity16_count.jpg"),ethnicity_plot16,width = 45, height = 30, units = "cm")
ethnicity_plot16_eng<-ethnicity %>%
filter(region=="England",group=="16_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","ethnicity16_count_eng.jpg"),ethnicity_plot16_eng,width = 30, height = 30, units = "cm")
####### NA removed
ethnicity_na<-read_csv(here::here("output", "tables","ethnic_group_noNA.csv"))
ethnicity_plot16_eng_na <-  ethnicity_na %>%
filter(region=="England",group=="16_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","na_removed","ethnicity16_count_eng_na.jpg"),ethnicity_plot16_eng_na,width = 30, height = 30, units = "cm")
ethnicity_plot_na<-ethnicity_na %>%
filter(region!="England",group=="5_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","na_removed","ethnicity_count_na.jpg"),ethnicity_plot_na,width = 45, height = 30, units = "cm")
ethnicity_plot_eng_na<-ethnicity_na %>%
filter(region=="England",group=="5_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","na_removed","ethnicity_count_eng_na.jpg"),ethnicity_plot_eng_na,width = 30, height = 30, units = "cm")
ethnicity_plot16_na<-ethnicity_na %>%
filter(region!="England",group=="16_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","na_removed","ethnicity16_count_na.jpg"),ethnicity_plot16_na,width = 45, height = 30, units = "cm")
################################################################################
# Description: Script to plot TPP & ONS data for deaths, imd, sex and age
#
# Input:  /output/tables/age_sex_count.csv.gz
#         /output/tables/age_count.csv.gz
#         /output/tables/death_count.csv.gz
#         /output/tables/imd_count.csv.gz
#         /output/tables/ethnic_group.csv
#
# output: output/plots/Cause_of_Death_count.jpg
#         output/plots/Cause_of_Death_count_eng.jpg
#         output/plots/imd_count.jpg
#         output/plots/age_sex_count.jpg
#         output/plots/age_sex_count_eng.jpg
#         output/plots/age_count.jpg
#         output/plots/age_count_eng.jpg
#         output/plots/sex_count.jpg
#         output/plots/sex_count_eng.jpg
#         output/plots/ethnicity_count.jpg
#         output/plots/ethnicity_count_eng.jpg
#         output/plots/ethnicity16_count.jpg
#         output/plots/ethnicity16_count_eng.jpg
#
# Author: Colm D Andrews
# Date:   26/11/2021
#
################################################################################
library(tidyverse)
library(scales)
library(readr)
agelevels<-c("0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90+")
fs::dir_create(here::here("output", "plots"))
fs::dir_create(here::here("output", "plots","na_removed"))
############################# deaths
death<-read_csv(here::here("output", "tables","death_count.csv"))
death_plot<-death %>%
filter(region!="England") %>%
ggplot(aes(x=Cause_of_Death, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all deaths")
ggsave(filename=here::here("output", "plots","Cause_of_Death_count.jpg"),death_plot,width = 30, height = 30, units = "cm")
death_plot_eng<-death %>%
filter(region=="England") %>%
ggplot(aes(x=Cause_of_Death, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all deaths")
ggsave(filename=here::here("output", "plots","Cause_of_Death_count_eng.jpg"),death_plot_eng,width = 30, height = 30, units = "cm")
##################################### imd
imd<-read_csv(here::here("output", "tables","imd_count.csv"))
imd_plot<-imd %>% filter(sex=="Total") %>%
ggplot(aes(x=imd, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") +
theme_classic() + theme(axis.text.x = element_text( hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of Population")
ggsave(filename=here::here("output", "plots","imd_count.jpg"),imd_plot)
################################################ age by sex
age_sex<-read_csv(here::here("output", "tables","age_sex_count.csv"))
age_sex<- age_sex %>%
mutate(percentage=case_when( sex=="Female"~percentage,sex=="Male"~(-1*percentage))) %>%
drop_na()
age_sex_plot<-age_sex %>%
filter(cohort=="ONS",region!="England") %>%
ggplot(aes(x = age_group, y = percentage, fill = sex,alpha=cohort)) + facet_wrap(~ region) +
geom_bar(stat = "identity",colour="grey3") + geom_bar(data=age_sex[which(age_sex$cohort=="TPP" & age_sex$region!="England"),], aes(x = age_group, y = percentage, fill = sex,alpha=cohort),stat = "identity",colour="white") +
coord_flip() +
scale_fill_brewer(palette = "Set1") +scale_alpha_discrete(range=c(0.3,0.7))+
scale_y_continuous(breaks = seq(-20, 20, 1),
labels = comma(c(seq(20,0,-1), seq(1,20,1)),accuracy=1)) +
theme_bw() + theme(text = element_text(size=16)) + scale_x_discrete(limits = agelevels) +
xlab("") + ylab(" % of cohort")
ggsave(filename=here::here("output", "plots","age_sex_count.jpg"),age_sex_plot,width = 60, height = 30, units = "cm")
age_sex_plot_eng<-age_sex %>%
filter(cohort=="ONS",region=="England") %>%
ggplot(aes(x = age_group, y = percentage, fill = sex,alpha=cohort)) + facet_wrap(~ region) +
geom_bar(stat = "identity",colour="grey3") + geom_bar(data=age_sex[which(age_sex$cohort=="TPP" & age_sex$region=="England"),], aes(x = age_group, y = percentage, fill = sex,alpha=cohort),stat = "identity",colour="white") +
coord_flip() +
scale_fill_brewer(palette = "Set1") +scale_alpha_discrete(range=c(0.3,0.7))+
scale_y_continuous(breaks = seq(-20, 20, 1),
labels = comma(c(seq(20,0,-1), seq(1,20,1)),accuracy=1)) +
theme_bw() + theme(text = element_text(size=16)) + scale_x_discrete(limits = agelevels) +
xlab("") + ylab(" % of cohort")
ggsave(filename=here::here("output", "plots","age_sex_count_eng.jpg"),age_sex_plot_eng,width = 20, height = 15, units = "cm")
################################################ age
age<-read_csv(here::here("output", "tables","age_count.csv"),col_types = cols(
age_group =  readr::col_factor(levels=agelevels)))
age_plot <-age %>%
filter(region!="England") %>%
ggplot(aes(x=age_group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size=16,angle = 90,hjust=0.95,vjust=0.2)) +
xlab("") + ylab(" % of cohort") +
scale_x_discrete(limits = agelevels)
ggsave(filename=here::here("output", "plots","age_count.jpg"),age_plot,width = 60, height = 30, units = "cm")
age_plot_eng <-age %>%
filter(region=="England") %>%
ggplot(aes(x=age_group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size=16,angle = 90,hjust=0.95,vjust=0.2)) +
xlab("") + ylab(" % of cohort") +
scale_x_discrete(limits = agelevels)
ggsave(filename=here::here("output", "plots","age_count_eng.jpg"),age_plot_eng,width = 15, height = 10, units = "cm")
############################################## sex
sex<-age_sex %>%
select(sex, cohort,N,region) %>%
group_by(cohort,sex,region) %>%
summarise(N = sum(N)) %>%
group_by(region,cohort) %>%
mutate(Total=sum(N)) %>%
ungroup %>%
mutate(percentage = round((N/Total)*100,2))
sex_plot<-sex %>%
filter(region!="England") %>%
ggplot(aes(x=sex, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge")  + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size=16,angle = 90,hjust=0.95,vjust=0.2)) +
xlab("") + ylab(" % of cohort")
ggsave(filename=here::here("output", "plots","sex_count.jpg"),sex_plot,width = 30, height = 15, units = "cm")
sex_plot_eng<-sex %>%
filter(region=="England") %>%
ggplot(aes(x=sex, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge")  + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size=16,angle = 90,hjust=0.95,vjust=0.2)) +
xlab("") + ylab(" % of cohort")
ggsave(filename=here::here("output", "plots","sex_count_eng.jpg"),sex_plot_eng,width = 15, height = 10, units = "cm")
############### ethnicity
ethnicity<-read_csv(here::here("output", "tables","ethnic_group.csv"))
ethnicity_plot<-ethnicity %>%
filter(region!="England",group=="5_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","ethnicity_count.jpg"),ethnicity_plot,width = 45, height = 30, units = "cm")
ethnicity_plot_eng<-ethnicity %>%
filter(region=="England",group=="5_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","ethnicity_count_eng.jpg"),ethnicity_plot_eng,width = 30, height = 30, units = "cm")
ethnicity_plot16<-ethnicity %>%
filter(region!="England",group=="16_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","ethnicity16_count.jpg"),ethnicity_plot16,width = 45, height = 30, units = "cm")
ethnicity_plot16_eng<-ethnicity %>%
filter(region=="England",group=="16_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","ethnicity16_count_eng.jpg"),ethnicity_plot16_eng,width = 30, height = 30, units = "cm")
####### NA removed
ethnicity_na<-read_csv(here::here("output", "tables","ethnic_group_noNA.csv"))
ethnicity_plot16_eng_na <-  ethnicity_na %>%
filter(region=="England",group=="16_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","na_removed","ethnicity16_count_eng_na.jpg"),ethnicity_plot16_eng_na,width = 30, height = 30, units = "cm")
ethnicity_plot_na<-ethnicity_na %>%
filter(region!="England",group=="5_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","na_removed","ethnicity_count_na.jpg"),ethnicity_plot_na,width = 45, height = 30, units = "cm")
ethnicity_plot_eng_na<-ethnicity_na %>%
filter(region=="England",group=="5_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","na_removed","ethnicity_count_eng_na.jpg"),ethnicity_plot_eng_na,width = 30, height = 30, units = "cm")
ethnicity_plot16_na<-ethnicity_na %>%
filter(region!="England",group=="16_2001") %>%
ggplot(aes(x=Ethnic_Group, y=percentage, fill=cohort)) +geom_bar(stat = "identity",position = "dodge") + facet_wrap(~ region) +
theme_classic() + theme(axis.text.x = element_text(size = 16, hjust=0,vjust=0)) + coord_flip() + xlab("") + ylab(" % of all ethnicitys")
ggsave(filename=here::here("output", "plots","na_removed","ethnicity16_count_na.jpg"),ethnicity_plot16_na,width = 45, height = 30, units = "cm")
imd_NA<- imd %>%
drop_na() %>%
group_by(sex,cohort) %>%
mutate(Total=sum(N),
N=round(N/5)*5,
Total=round(Total/5)*5,
percentage = round(N/Total*100,4))
View(imd)
View(imd_NA)
imd_NA<- imd %>%
filter(sex == "MALE" | sex =="Female") %>%
group_by(sex,cohort) %>%
mutate(Total=sum(N),
N=round(N/5)*5,
Total=round(Total/5)*5,
percentage = round(N/Total*100,4))
True~sex)
imd_sex<-df_input %>%
group_by(imd,sex) %>%
summarise(N = n()) %>%
mutate(sex = case_when(sex=="Female"~"Females",
sex=="Male" ~ "Males",
True~sex))
imd_sex
imd_sex<-df_input %>%
group_by(imd,sex) %>%
summarise(N = n()) %>%
mutate(sex = case_when(sex=="Female"~"Females",
sex=="Male" ~ "Males",
T~sex))
imd<-imd_sex%>%
group_by(imd) %>%
summarise(N=sum(N)) %>%
mutate(sex="Total") %>% bind_rows(imd_sex) %>%
mutate(cohort="TPP")  %>%
bind_rows(imd_ons)%>%
group_by(sex,cohort) %>%
mutate(Total=sum(N),
N=round(N/5)*5,
Total=round(Total/5)*5,
percentage = round(N/Total*100,4)) %>%
ungroup() %>% arrange(cohort,sex,imd) %>%
mutate(imd = case_when(imd==1~"1: Most deprived",
imd==2~"2",
imd==3~"3",
imd==4~"4",
imd==0~"Unknown",
imd==5~"5: Least deprived"))
imd_NA<- imd %>%
filter(sex == "Males" | sex =="Females") %>%
group_by(sex,cohort) %>%
mutate(Total=sum(N),
N=round(N/5)*5,
Total=round(Total/5)*5,
percentage = round(N/Total*100,4))
imd_NA<- imd %>%
filter(sex == "Males" | sex =="Females" | sex=="Total") %>%
group_by(sex,cohort) %>%
mutate(Total=sum(N),
N=round(N/5)*5,
Total=round(Total/5)*5,
percentage = round(N/Total*100,4))
imd_NA<- imd %>%
filter(imd!="Unknown") %>%
group_by(sex,cohort) %>%
mutate(Total=sum(N),
N=round(N/5)*5,
Total=round(Total/5)*5,
percentage = round(N/Total*100,4))
imd <- imd_unrounded %>%
group_by(sex,cohort) %>%
mutate(Total=sum(N),
N=round(N/5)*5,
Total=round(Total/5)*5,
percentage = round(N/Total*100,4)) %>%
ungroup() %>% arrange(cohort,sex,imd) %>%
mutate(imd = case_when(imd==1~"1: Most deprived",
imd==2~"2",
imd==3~"3",
imd==4~"4",
imd==0~"Unknown",
imd==5~"5: Least deprived"))
imd_unrounded<-imd_sex%>%
group_by(imd) %>%
summarise(N=sum(N)) %>%
mutate(sex="Total") %>% bind_rows(imd_sex) %>%
mutate(cohort="TPP")  %>%
bind_rows(imd_ons)
imd <- imd_unrounded %>%
group_by(sex,cohort) %>%
mutate(Total=sum(N),
N=round(N/5)*5,
Total=round(Total/5)*5,
percentage = round(N/Total*100,4)) %>%
ungroup() %>% arrange(cohort,sex,imd) %>%
mutate(imd = case_when(imd==1~"1: Most deprived",
imd==2~"2",
imd==3~"3",
imd==4~"4",
imd==0~"Unknown",
imd==5~"5: Least deprived"))
write_csv(imd,here::here("output", "tables","imd_count.csv"))  ####add .gz to the end
imd_NA<-imd_unrounded %>%
filter(imd!="Unknown") %>%
group_by(sex,cohort) %>%
mutate(Total=sum(N),
N=round(N/5)*5,
Total=round(Total/5)*5,
percentage = round(N/Total*100,4)) %>%
ungroup() %>% arrange(cohort,sex,imd) %>%
mutate(imd = case_when(imd==1~"1: Most deprived",
imd==2~"2",
imd==3~"3",
imd==4~"4",
imd==0~"Unknown",
imd==5~"5: Least deprived"))
View(imd_NA)
View(imd)
imd_NA<-imd_unrounded %>%
filter(imd!="Unknown") %>%
group_by(sex,cohort) %>%
mutate(Total=sum(N),
N=round(N/5)*5,
Total=round(Total/5)*5,
percentage = round(N/Total*100,4)) %>%
ungroup() %>% arrange(cohort,sex,imd) %>%
mutate(imd = case_when(imd==1~"1: Most deprived",
imd==2~"2",
imd==3~"3",
imd==4~"4",
imd==0~"Unknown",
imd==5~"5: Least deprived"))
imd_NA<-imd_unrounded %>%
filter(imd!="Unknown")
imd_NA<-imd_unrounded %>%
filter(imd!=0) %>%
group_by(sex,cohort) %>%
mutate(Total=sum(N),
N=round(N/5)*5,
Total=round(Total/5)*5,
percentage = round(N/Total*100,4)) %>%
ungroup() %>% arrange(cohort,sex,imd) %>%
mutate(imd = case_when(imd==1~"1: Most deprived",
imd==2~"2",
imd==3~"3",
imd==4~"4",
imd==0~"Unknown",
imd==5~"5: Least deprived"))
### Add England
ethnicity_unrounded <-ethnicity %>%
group_by(group,Ethnic_Group,cohort) %>%
summarise(N=sum(N)) %>%
group_by(group,cohort) %>%
mutate(N=N,
Total=sum(N),
region="England") %>%
bind_rows(ethnicity) %>%
ethnicity2 <- ethnicity_unrounded %>%
## add rounding
mutate(N=round(N/5)*5,
Total=round(Total/5)*5,
percentage=N/Total * 100)
eth_tpp_16 <- df_input %>%
mutate(Ethnic_Group=case_when(
ethnicity_16 == "1" ~ "British",
ethnicity_16 == "2" ~ "Irish",
ethnicity_16 == "3" ~ "Other White",
ethnicity_16 == "4" ~ "White and Black Caribbean",
ethnicity_16 == "5" ~ "White and Black African",
ethnicity_16 == "6" ~ "White and Asian",
ethnicity_16 == "7" ~ "Other Mixed",
ethnicity_16 == "8" ~ "Indian",
ethnicity_16 == "9" ~ "Pakistani",
ethnicity_16 == "10" ~ "Bangladeshi",
ethnicity_16 == "11" ~ "Other Asian",
ethnicity_16 == "12" ~ "Caribbean",
ethnicity_16 == "13" ~ "African",
ethnicity_16 == "14" ~ "Other Black",
ethnicity_16 == "15" ~ "Chinese",
ethnicity_16 == "16" ~ "Any other ethnic group"))  %>%
group_by(region,Ethnic_Group) %>%
summarise(N=n()) %>%
ungroup %>%
group_by(region) %>%
mutate(Total = sum(N),
cohort="TPP",
group="16_2001")
ethnicity<-eth_tpp_16 %>%
bind_rows(eth_tpp) %>%
bind_rows(eth_ons)
ethnicity_unrounded
ethnicity<-eth_tpp_16 %>%
bind_rows(eth_tpp) %>%
bind_rows(eth_ons)
### Add England
ethnicity_unrounded <-ethnicity %>%
group_by(group,Ethnic_Group,cohort) %>%
summarise(N=sum(N)) %>%
group_by(group,cohort) %>%
mutate(N=N,
Total=sum(N),
region="England") %>%
bind_rows(ethnicity) %>%
ethnicity2 <- ethnicity_unrounded %>%
## add rounding
mutate(N=round(N/5)*5,
Total=round(Total/5)*5,
percentage=N/Total * 100)
eth_tpp_16 <- df_input %>%
mutate(Ethnic_Group=case_when(
ethnicity_16 == "1" ~ "British",
ethnicity_16 == "2" ~ "Irish",
ethnicity_16 == "3" ~ "Other White",
ethnicity_16 == "4" ~ "White and Black Caribbean",
ethnicity_16 == "5" ~ "White and Black African",
ethnicity_16 == "6" ~ "White and Asian",
ethnicity_16 == "7" ~ "Other Mixed",
ethnicity_16 == "8" ~ "Indian",
ethnicity_16 == "9" ~ "Pakistani",
ethnicity_16 == "10" ~ "Bangladeshi",
ethnicity_16 == "11" ~ "Other Asian",
ethnicity_16 == "12" ~ "Caribbean",
ethnicity_16 == "13" ~ "African",
ethnicity_16 == "14" ~ "Other Black",
ethnicity_16 == "15" ~ "Chinese",
ethnicity_16 == "16" ~ "Any other ethnic group"))  %>%
group_by(region,Ethnic_Group) %>%
summarise(N=n()) %>%
ungroup %>%
group_by(region) %>%
mutate(Total = sum(N),
cohort="TPP",
group="16_2001")
ethnicity<-eth_tpp_16 %>%
bind_rows(eth_tpp) %>%
bind_rows(eth_ons)
### Add England
ethnicity_unrounded <-ethnicity %>%
group_by(group,Ethnic_Group,cohort) %>%
summarise(N=sum(N)) %>%
group_by(group,cohort) %>%
mutate(N=N,
Total=sum(N),
region="England") %>%
bind_rows(ethnicity) %>%
ethnicity2 <- ethnicity_unrounded %>%
## add rounding
mutate(N=round(N/5)*5,
Total=round(Total/5)*5,
percentage=N/Total * 100)
### Add England
ethnicity_unrounded <-ethnicity %>%
group_by(group,Ethnic_Group,cohort) %>%
summarise(N=sum(N)) %>%
group_by(group,cohort) %>%
mutate(N=N,
Total=sum(N),
region="England") %>%
bind_rows(ethnicity)
View(ethnicity_unrounded)
ethnicity_na<-ethnicity_unrounded %>%
drop_na(Ethnic_Group) %>%
group_by(group,cohort, region) %>%
mutate(N=N,
Total=sum(N),
percentage=N/Total * 100)
View(ethnicity_na)
View(ethnicity2)
ethnicity_na<-ethnicity_unrounded %>%
drop_na(Ethnic_Group) %>%
group_by(group,cohort, region) %>%
mutate(N=round(N/5)*5,
Total=round(Total/5)*5,
percentage=N/Total * 100)
